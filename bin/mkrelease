#!/bin/bash
# Make a release of the xMML format. Part of the xMML distribution.
# Author: J.Borgdorff, created 2011-02-21
# Start in xMML directory

VERSION=$1
TAG=v$VERSION
DIR=release/xmml-$VERSION
TARDIR=$DIR-tar
SUCCEED=0
BRANCH=`git branch | grep \* | sed -e 's/\*//' | sed -e 's/[[:space:]]*//g'`

git checkout -q $TAG 1>/dev/null 2>&1

if [[ $? -ne 0 ]]; then
  echo "ERROR: can not check out tag of the version specified"
  exit
fi

mkdir -p $DIR
if [[ `grep \"$VERSION\" xmml.dtd | wc -l` -gt 0 ]]; then
	cp xmml.dtd $DIR/xmml-$VERSION.dtd
	cp xmml.dtd $TARDIR/xmml.dtd
else
	echo "WARNING: xMML Document Type Definition does not match version of Git repository"
	SUCCEED=1
fi

if [[ `grep \"$VERSION\" xMML.xsd.xml | wc -l` -gt 0 ]]; then
	cp xMML.xsd.xml $DIR/xMML-$VERSION.xsd
	cp xMML.xsd.xml $TARDIR/xMML.xsd
else
	echo "WARNING: xMML Schema Definition does not match version of Git repository"
	SUCCEED=1
fi

cp CHANGELOG.txt $DIR/CHANGELOG.txt
tar czf $DIR.tar.gz $TARDIR
rm -r $TARDIR

git checkout -q $BRANCH

if [[ $SUCCEED -eq 0 ]]; then
	echo "Release $VERSION created in directory $DIR"
fi

