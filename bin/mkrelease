#!/bin/bash
# Make a release of the xMML format. Part of the xMML distribution.
# Author: J.Borgdorff, created 2011-02-21
# Start in xMML directory

VERSION=$1
TAG=v$VERSION
DIR=release/$TAG
SUCCEED=0

git stash -q
REV=`git rev-parse HEAD`

git checkout -q $TAG
mkdir -p release/$TAG
if [[ `grep $VERSION xmml.dtd | wc -l` -gt 0 ]]; then
	cp xmml.dtd $DIR/xmml-$VERSION.dtd
else
	echo "WARNING: xMML Document Type Definition does not match version of Git repository"
	SUCCEED=1
fi

if [[ `grep $VERSION xMML.xsd.xml | wc -l` -gt 0 ]]; then
	cp xMML.xsd.xml $DIR/xMML-$VERSION.xsd.xml
else
	echo "WARNING: xMML Schema Definition does not match version of Git repository"
	SUCCEED=1
fi

git checkout -q $REV
git stash pop -q

if [[ $SUCCEED -eq 0 ]]; then
	echo "Release $VERSION created in directory $DIR"
fi

