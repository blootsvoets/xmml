<?xml version="1.0" standalone="no"?>
<!DOCTYPE model SYSTEM "xmml.dtd">
<model id="ISR2D" name="In-stent restenosis 2D" xmml_version="0.1" xmlns:xi="http://www.w3.org/2001/XInclude">
  <description>
    A model of the process that occurs in the artery after stenting.
  </description>
  
  <definitions>
    <xi:include href="isr_meta.xml#xpointer(/metadata/*)"/>
  
    <submodel id="INIT" name="Initial cell conditions">
      <timescale delta="1E-3" max="1E-1"/>
      <spacescale delta="1E-5" max="1E-3"/>
      <spacescale delta="1E-5" max="1E-3"/>

      <ports>
        <out id="cells" operator="Of" datatype="agentLocations"/>
      </ports>
    </submodel>
  
    <submodel id="BF" name="Blood flow" stateful="optional">
      <timescale delta="1E-7" max="1"/>
      <spacescale delta="1E-5" max="1E-3"/>
      <spacescale delta="1E-5" max="1E-3"/>

      <ports>
        <in id="state_start" operator="finit" type="state"/>
        <in id="boundary" operator="S" datatype="latticeInt"/>
        <out id="shear_stress" operator="Of" datatype="latticeDouble"/>
        <out id="state_end" operator="Of" type="state"/>
      </ports>
    </submodel>
  
    <submodel id="SMC" name="Smooth muscle cells">
      <timescale delta="1E3" max="1E7"/>
      <spacescale delta="1E-5" max="1E-3"/>
      <spacescale delta="1E-5" max="1E-3"/>
      <param id="n" value="1000"/>
    
      <ports>
        <in id="initial_positions" operator="finit" datatype="agentLocations"/>
        <in id="shear_stress" operator="S" datatype="agentDouble"/>
        <in id="drug_concentration" operator="S" datatype="agentDouble"/>
        <out id="cell_positions" operator="Oi" datatype="agentLocations"/>
      </ports>
    </submodel>
  
    <submodel id="DD" name="Drug diffusion">
      <timescale delta="1E3" max="1E7"/>
      <spacescale delta="1E-5" max="1E-3"/>
      <spacescale delta="1E-5" max="1E-3"/>
    
      <ports>
        <in id="boundary" operator="finit" datatype="latticeInt"/>
        <out id="drug_concentration" operator="Of" datatype="latticeDouble"/>
      </ports>
    </submodel>
  </definitions>
  
  <topology>
    <instance id="ic" submodel="INIT" domain="artery"/>
    <instance id="bf" submodel="BF" domain="artery.blood"/>
    <instance id="dd" submodel="DD" domain="artery.tissue"/>
    <instance id="smc" submodel="SMC" domain="artery.tissue"/>
    
    <coupling from="ic.cells" to="smc.initial_positions"/>
    <coupling from="smc.cell_positions" to="dd.boundary"/>
    <coupling from="smc.cell_positions" to="bf.boundary"/>
    <coupling from="dd.drug_concentration" to="smc.drug_concentration"/>
    <coupling from="bf.shear_stress" to="smc.shear_stress"/>
  </topology>
</model>
